{% extends "base.html" %}
{% load jformat %}
{% block title %}Ù„ÛŒØ³Øª Ø§Ù…ØªØ­Ø§Ù†Ø§Øª{% endblock %}

{% block content %}
<div class="app-content">
  <div class="container-fluid">

    <!-- Ø¹Ù†ÙˆØ§Ù† Ùˆ Ø¯Ú©Ù…Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2 class="h5">ğŸ“‹ Ù„ÛŒØ³Øª Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</h2>
      <a href="{% url 'examtype_create' %}" class="btn btn-primary btn-sm">
        <i class="bi bi-plus-circle"></i> Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ù…ØªØ­Ø§Ù†
      </a>
    </div>

    <div class="table-responsive">
      <table class="table table-sm table-striped table-hover table-bordered align-middle small">
        <thead class="table-dark">
          <tr>
            <th>Ø´Ù…Ø§Ø±Ù‡</th>
            <th>Ù†Ø§Ù… Ø§Ù…ØªØ­Ø§Ù†</th>
            <th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th>
            <th>Ø³Ø§Ù„ ØªØ­ØµÛŒÙ„ÛŒ</th>
            <th>Ø§ÛŒØ§Ù… Ø¢Ù…ÙˆØ²Ø´ÛŒ</th>
            <th>Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡ ØªÙˆØ³Ø·</th>
            <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
          </tr>
        </thead>
        <tbody>
          {% for exam in exams %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ exam.name }}</td>
            <td>{{ exam.description|default:"-" }}</td>
            <td>{{ exam.academic_year }}</td>
            <td>{{ exam.academic_year_days }}</td>
            <td>
              {% if exam.created_by %}
                {{ exam.created_by.get_full_name|default:exam.created_by.username }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              {% if exam.created_by == request.user %}
              <a href="{% url 'examtype_update' exam.pk %}" class="btn btn-sm btn-warning mb-1">
                <i class="bi bi-pencil-square"></i> ÙˆÛŒØ±Ø§ÛŒØ´
              </a>
              <a href="{% url 'examtype_delete' exam.pk %}" class="btn btn-sm btn-danger mb-1">
                <i class="bi bi-trash"></i> Ø­Ø°Ù
              </a>
              {% else %}
                <span class="text-muted small">ğŸ”’ Ù‚Ø§Ø¨Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ù†ÛŒØ³Øª</span>
              {% endif %}

              <!-- Ø¯Ú©Ù…Ù‡ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø´Ø§Ú¯Ø±Ø¯Ø§Ù† Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø¯Ø± Ø§Ù…ØªØ­Ø§Ù† -->
              <button type="button" class="btn btn-sm btn-info mb-1" data-bs-toggle="modal" data-bs-target="#examStudentsModal{{ exam.id }}">
                <i class="bi bi-people-fill"></i> Ø´Ø§Ú¯Ø±Ø¯Ø§Ù†
              </button>

              <!-- Modal Ù†Ù…Ø§ÛŒØ´ Ø´Ø§Ú¯Ø±Ø¯Ø§Ù† -->
              <div class="modal fade" id="examStudentsModal{{ exam.id }}" tabindex="-1" aria-labelledby="examStudentsModalLabel{{ exam.id }}" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="examStudentsModalLabel{{ exam.id }}">Ø´Ø§Ú¯Ø±Ø¯Ø§Ù† Ø§Ù…ØªØ­Ø§Ù† {{ exam.name }}</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      {% if exam.students.exists %}
                        <ul class="list-group list-group-flush">
                          {% for student in exam.students.all %}
                            <li class="list-group-item">
                              {{ student.user.first_name }} {{ student.user.last_name }} - Ø´Ù…Ø§Ø±Ù‡: {{ student.student_number }}
                            </li>
                          {% endfor %}
                        </ul>
                      {% else %}
                        <p class="text-muted">Ù‡ÛŒÚ† Ø´Ø§Ú¯Ø±Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø§Ù…ØªØ­Ø§Ù† Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
                      {% endif %}
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¨Ø³ØªÙ†</button>
                    </div>
                  </div>
                </div>
              </div>

            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="text-center text-muted py-3">Ù‡ÛŒÚ† Ø§Ù…ØªØ­Ø§Ù†ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ -->
    <div class="mt-3">
      <a href="{% url 'home' %}" class="btn btn-secondary btn-sm">
        <i class="bi bi-arrow-left-circle"></i> Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
      </a>
    </div>

  </div>
</div>
{% endblock %}
