{% extends "base.html" %}
{% load jformat %}
{% block title %}Ù„ÛŒØ³Øª Ø´Ø§Ú¯Ø±Ø¯Ø§Ù†{% endblock %}

{% block content %}
<div class="app-content">
  <div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2 class="h5">ğŸ“š Ù„ÛŒØ³Øª Ø´Ø§Ú¯Ø±Ø¯Ø§Ù†</h2>
      <div class="">
        <a href="{% url 'create_student' %}" class="btn btn-primary btn-sm">
          <i class="bi bi-plus-circle"></i> Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø´Ø§Ú¯Ø±Ø¯
        </a>
        <a href="{% url 'upload_students' %}" class="btn btn-outline-primary btn-sm">
          <i class="bi bi-plus-circle"></i> Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„ Ø´Ø§Ú¯Ø±Ø¯
        </a>
      </div>

    </div>


    <div class="table-responsive">
      <table class="table table-sm table-striped table-hover table-bordered align-middle small">
        <thead class="table-dark">
          <tr>
            <th>Ø´Ù…Ø§Ø±Ù‡</th>
            <th>Ù†Ù…Ø¨Ø± Ø§Ø³Ø§Ø³</th>
            <th>Ù†Ø§Ù… Ú©Ø§Ù…Ù„</th>
            <th>Ù†Ø§Ù… Ù¾Ø¯Ø±</th>
            <th>Ù†Ø§Ù… Ù¾Ø¯Ø± Ú©Ù„Ø§Ù†</th>
            <th>ØµÙ†Ù</th>
            <th>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</th>
            <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
          </tr>
        </thead>
        <tbody>
          {% for student in students %}
          <tr>
            <!-- Ø´Ù…Ø§Ø±Ù‡ Ù…Ø³Ù„Ø³Ù„ -->
            <td>{{ forloop.counter }}</td>
            <td>{{ student.student_number }}</td>
            <td>
              <a href="{% url 'student_profile' student.pk %}">
                <strong>{{ student.user.first_name }} {{ student.user.last_name }}</strong>
              </a>
            </td>
            <td>{{ student.father_name }}</td>
            <td>{{ student.grandfather_name }}</td>
            <td>
              {% for cls in student.classes.all %}
                {{ cls.name }}{% if not forloop.last %}, {% endif %}
              {% empty %}
                -
              {% endfor %}
            </td>

            <td>{{ student.phone }}</td>

            <td>
              <a href="{% url 'edit_student' pk=student.id %}" class="btn btn-sm btn-warning mb-1">
                <i class="bi bi-pencil-square"></i> ÙˆÛŒØ±Ø§ÛŒØ´
              </a>
              <a href="{% url 'delete_student' pk=student.id %}" class="btn btn-sm btn-danger mb-1">
                <i class="bi bi-trash"></i> Ø­Ø°Ù
              </a>
              <!-- Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…Ø¯Ø§Ù„ -->
              <button type="button" class="btn btn-sm btn-danger mb-1" data-bs-toggle="modal" data-bs-target="#reportCardModal{{ student.id }}">
                <i class="bi bi-file-earmark-text"></i> Ú©Ø§Ø±Ù†Ø§Ù…Ù‡
              </button>

             
<!-- Modal -->
<div class="modal fade" id="reportCardModal{{ student.id }}" tabindex="-1" aria-labelledby="reportCardModalLabel{{ student.id }}" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="GET" action="{% url 'student_report_card' student.id %}">
        <div class="modal-header">
          <h5 class="modal-title" id="reportCardModalLabel{{ student.id }}">Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø¨Ø±Ø§ÛŒ {{ student.user.full_name_display }}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          {% for exam in exam_types %}
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="exams" value="{{ exam.id }}" id="examCheck{{ exam.id }}">
            <label class="form-check-label" for="examCheck{{ exam.id }}">
              {{ exam.name }} - Ø³Ø§Ù„: {{ exam.academic_year }} ({{ exam.academic_year_days }} Ø±ÙˆØ²)
            </label>
          </div>
          {% endfor %}
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ø±Ù†Ø§Ù…Ù‡</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø§Ù†ØµØ±Ø§Ù</button>
        </div>
      </form>
    </div>
  </div>
</div>

            
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="text-center">Ù‡ÛŒÚ† Ø´Ø§Ú¯Ø±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <a href="{% url 'home' %}" class="btn btn-secondary btn-sm mt-3">
      <i class="bi bi-arrow-left-circle"></i> Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
    </a>
  </div>
</div>


{% endblock %}